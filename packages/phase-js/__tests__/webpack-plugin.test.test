import webpack from "webpack";

// 0. Import the config that uses my plugin
import options from "./webpack.config.js";

describe("It compiles with webpack properly", () => {
  it("Compiles routes nested at one level", done => {
    expect.assertions(3);

    // 1. Run webpack
    webpack(options, function(err, stats) {
      // 2. Fail test if there are errors
      if (err) {
        return done(err);
      } else if (stats.hasErrors()) {
        return done(stats.toString());
      }

      // 3. Map asset objects to output filenames
      const files = stats.toJson().assets.map(x => x.name);

      // 4. Run assertions.

      // assert routes.js existence (and verify it works?)
      expect(files.indexOf("routes.js")).not.toBe(-1);

      // assert assets
      expect(files.indexOf("app.js")).not.toBe(-1);
      expect(files.indexOf("app.css")).not.toBe(-1);

      done();
    });
  });
});
